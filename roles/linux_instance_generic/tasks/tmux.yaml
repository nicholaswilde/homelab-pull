---
- name: "Run tmux Block"
  block:
    - name: "Create .config directory if it does not exist"
      ansible.builtin.file:
        path: "{{ ansible_env.HOME }}/.config"
        state: directory

    - name: "Create tpm directory if it does not exist"
      ansible.builtin.file:
        path: "{{ ansible_env.HOME }}/.tmux/plugins/tpm"
        state: directory

    - name: "Install tmux plugins manager (tpm)"
      ansible.builtin.git:
        repo: 'https://github.com/tmux-plugins/tpm'
        dest: "{{ ansible_env.HOME }}/.tmux/plugins/tpm"
        accept_hostkey: true
        force: true
      become: false
      register: tpm_result

    - name: "Install tmux plugins"
      ansible.builtin.command: "{{ ansible_env.HOME }}/.tmux/plugins/tpm/bin/install_plugins"
      environment:
        TMUX_PLUGIN_MANAGER_PATH: "{{ ansible_env.HOME }}/.tmux/plugins/"
      when: tpm_result.changed
      become: false
  vars:
    TMUX_PLUGIN_MGR_PATH: "{{ ansible_env.HOME }}/.tmux/plugins/"
